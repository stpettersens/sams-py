<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>360ify</title>
        <!-- Link resource will be added dynamically after configuration -->
		<style type="text/css">
			body { 
				font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;
				font-size: 12px;
				text-align:center;
			}
			.important { 
				color: #FF0000;
				font-weight: bold;
			}
			a { 
				color: #000000;
			}
			a:hover {
				text-decoration: none;
			}
			fieldset {
				border-style: none;
			}
		
		</style>
		<!-- Installation code uses functionality offered by jQuery -->
		<script type="application/javascript" src="../lib/jquery-1.3.2.min.js"></script>
		<script type="application/javascript">
			<!--
			// Function to create a configured script for a specific gamertag
			function configure(script) { 
			    var script = script + '.js';
				var gamerTag, newScript = null;
				while(gamerTag == null || gamerTag == "") {
					gamerTag = prompt("Enter your Xbox Live gamer tag:");
					if(gamerTag == "") alert("You must enter a gamer tag.");
				}
				$.get(script, function(data) {
					newScript = data.replace(/%GAMER%/, gamerTag);
				});
				// Invoke a PHP server side script to write the modfied file to the cache
			    var fw = '../utils/file_cloner.php?prj=' + script + '&data=' + newScript + '&ext="js"';
				// TODO... Cloned file will be 360ify_${GUID}.js
				
				// Insert configured script as a resource that can now be installed into Jetpack
				$('head').append('<link rel="jetpack" href="cached/' + newScript + '"/>');
				// Cross configuration step off the list and remove configure button
				$('li:first').css('text-decoration', 'line-through');
				$('form').remove();
				// Display instruction and notice that script will be wiped from server after 5 minutes
				var msg = 'If you have <a href=\'https://jetpack.mozillalabs.com\'>';
				msg += 'Jetpack</a> installed, you should now see a notice at the top of';
				msg += ' this page which will allow you to install the script.<br/> Your configured script will';
				msg += ' be deleted from this web server after 5 minutes.';
				$('body').append('<p style="font-style: italic;">' + msg + '</p>');
			}
			-->
		</script>
    </head>
    <body>
        <div class="blurb">
        	<h1>360ify for Jetpack.</h1>
			<noscript>
				<p class="important">JavaScript must be enabled to install this Jetpack.</p>
			</noscript>
			<ol>
				<li>Configure 360ify to use your gamer tag</li>
				<li>Install 360ify Jetpack feature</li>
			</ol>
		    <form action="null">
		    	<fieldset>
					<input onclick="configure('360ify');" value="Configure..." type="button"></input>
				</fieldset>
			</form>
        </div>
    </body>
</html>
